"use strict";exports.__esModule=true;exports.setConfig=exports.getNextFocus=void 0;function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t["return"]||t["return"]()}finally{if(u)throw o}}}}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var focusableSelector="[tabindex], a, input, button";var containerSelector="nav, section, .lrud-container";var ignoreSelector=".lrud-ignore, [disabled]";var DESTINATIONS_ATTRIBUTE="data-destinations";var DATA_BLOCK_EXIT_ATTRIBUTE="data-block-exit";var DATA_AUTOFOCUS_ATTRIBUTE="data-autofocus";var DATA_FOCUS_ATTRIBUTE="data-focus";var _left="left",_right="right",_up="up",_down="down";var _keyMap={4:_left,21:_left,37:_left,214:_left,205:_left,218:_left,5:_right,22:_right,39:_right,213:_right,206:_right,217:_right,29460:_up,19:_up,38:_up,211:_up,203:_up,215:_up,29461:_down,20:_down,40:_down,212:_down,204:_down,216:_down,"ArrowLeft":_left,"ArrowRight":_right,"ArrowUp":_up,"ArrowDown":_down};var createMissingId=null;var setConfig=exports.setConfig=function setConfig(config){_keyMap=config.keyMap||_keyMap;createMissingId=typeof config.createMissingId==="function"?config.createMissingId:null};var getId=function getId(element){var _element$id;return element.id&&(_element$id=element.id)!==null&&_element$id!==void 0&&_element$id.length?element.id:createMissingId?createMissingId(element):""};var matches=function matches(element,selectors){if(!element){console.warn("matches() passed with a null element");return false}var fn=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){var matches=(this.document||this.ownerDocument).querySelectorAll(s),i=matches.length;while(--i>=0&&matches.item(i)!==this){}return i>-1};return fn.call(element,selectors)};var toArray=function toArray(nodeList){return Array.prototype.slice.call(nodeList)};var _getParentContainer=function getParentContainer(elem){if(!elem.parentElement||elem.parentElement.tagName==="BODY"){return null}else if(matches(elem.parentElement,containerSelector)){return elem.parentElement}return _getParentContainer(elem.parentElement)};var getFocusables=function getFocusables(scope){if(!scope)return[];var ignoredElements=toArray(scope.querySelectorAll(ignoreSelector));return toArray(scope.querySelectorAll(focusableSelector)).filter(function(node){return!ignoredElements.some(function(ignored){return ignored==node||ignored.contains(node)})}).filter(function(node){return matches(node,containerSelector)||parseInt(node.getAttribute("tabindex")||"0",10)>-1})};var getDefaultFocus=function getDefaultFocus(scope){var focus=null;var ignoredElements=toArray(scope.querySelectorAll(ignoreSelector));var focusables=toArray(scope.querySelectorAll(focusableSelector)).filter(function(node){return!ignoredElements.some(function(ignored){return ignored==node||ignored.contains(node)})}).filter(function(node){return parseInt(node.getAttribute("tabindex")||"0",10)>-1});focus=focusables===null||focusables===void 0?void 0:focusables[0];var parentContainer=_getParentContainer(focusables===null||focusables===void 0?void 0:focusables[0]);if(parentContainer){focus=getPreferredDestination(parentContainer);if(focus!==undefined&&focus!==null){var _focus;parentContainer===null||parentContainer===void 0||parentContainer.setAttribute(DATA_FOCUS_ATTRIBUTE,(_focus=focus)===null||_focus===void 0?void 0:_focus.id);return focus}focus=document.getElementById(parentContainer===null||parentContainer===void 0?void 0:parentContainer.getAttribute(DATA_FOCUS_ATTRIBUTE));if(focus){return focus}}return focusables===null||focusables===void 0?void 0:focusables[0]};var getAllFocusables=function getAllFocusables(scope){return([].concat(getFocusables(scope)))};var collectContainers=function collectContainers(initialContainer){if(!initialContainer)return[];var acc=[initialContainer];var cur=initialContainer;while(cur){cur=_getParentContainer(cur);if(cur)acc.push(cur)}return acc};var getMidpointForEdge=function getMidpointForEdge(rect,dir){switch(dir){case"left":return{x:rect.left,y:(rect.top+rect.bottom)/2};case"right":return{x:rect.right,y:(rect.top+rect.bottom)/2};case"up":return{x:(rect.left+rect.right)/2,y:rect.top};case"down":return{x:(rect.left+rect.right)/2,y:rect.bottom}}};var getNearestPoint=function getNearestPoint(point,dir,rect){if(dir==="left"||dir==="right"){var x=dir==="left"?rect.right:rect.left;if(point.y<rect.top)return{x:x,y:rect.top};if(point.y>rect.bottom)return{x:x,y:rect.bottom};return{x:x,y:point.y}}else if(dir==="up"||dir==="down"){var y=dir==="up"?rect.bottom:rect.top;if(point.x<rect.left)return{x:rect.left,y:y};if(point.x>rect.right)return{x:rect.right,y:y};return{x:point.x,y:y}}};var getDistanceBetweenPoints=function getDistanceBetweenPoints(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))};var isBelow=function isBelow(a,b){return a.y>b.y};var isRight=function isRight(a,b){return a.x>b.x};var getBlockedExitDirs=function getBlockedExitDirs(container,candidateContainer){if(!container){return[]}var currentAncestorContainers=collectContainers(container);var candidateAncestorContainers=collectContainers(candidateContainer);for(var i=0;i<candidateAncestorContainers.length;i++){var commonCandidate=candidateAncestorContainers[i];var spliceIndex=currentAncestorContainers.indexOf(commonCandidate);if(spliceIndex>-1){currentAncestorContainers.splice(spliceIndex);break}}return currentAncestorContainers.reduce(function(acc,cur){var dirs=((cur===null||cur===void 0?void 0:cur.getAttribute(DATA_BLOCK_EXIT_ATTRIBUTE))||"").split(" ");return acc.concat(dirs)},[])};var isValidCandidate=function isValidCandidate(entryRect,exitDir,exitPoint,entryWeighting){if(entryRect.width===0&&entryRect.height===0)return false;if(!entryWeighting&&entryWeighting!=0)entryWeighting=0.3;var weightedEntryPoint={x:entryRect.left+entryRect.width*(exitDir==="left"?1-entryWeighting:exitDir==="right"?entryWeighting:0.5),y:entryRect.top+entryRect.height*(exitDir==="up"?1-entryWeighting:exitDir==="down"?entryWeighting:0.5)};if(exitDir==="left"&&isRight(exitPoint,weightedEntryPoint)||exitDir==="right"&&isRight(weightedEntryPoint,exitPoint)||exitDir==="up"&&isBelow(exitPoint,weightedEntryPoint)||exitDir==="down"&&isBelow(weightedEntryPoint,exitPoint))return true;return false};var sortValidCandidates=function sortValidCandidates(candidates,elem,exitDir){var exitRect=elem.getBoundingClientRect();var exitPoint=getMidpointForEdge(exitRect,exitDir);return candidates.filter(function(candidate){var entryRect=candidate.getBoundingClientRect();var allowedOverlap=parseFloat(candidate.getAttribute("data-lrud-overlap-threshold"));return isValidCandidate(entryRect,exitDir,exitPoint,allowedOverlap)}).map(function(candidate){var entryRect=candidate.getBoundingClientRect();var nearestPoint=getNearestPoint(exitPoint,exitDir,entryRect);var distance=getDistanceBetweenPoints(exitPoint,nearestPoint);return{candidate:candidate,distance:distance}}).sort(function(a,b){return a.distance-b.distance}).map(function(_ref){var candidate=_ref.candidate;return candidate})};var getPreferredDestination=function getPreferredDestination(parentContainer){var destinations=parentContainer===null||parentContainer===void 0?void 0:parentContainer.getAttribute(DESTINATIONS_ATTRIBUTE);if(destinations!==null&&destinations!==void 0&&destinations.length){var candidateIDs=destinations.split(" ");var newFocus=null;var _iterator=_createForOfIteratorHelper(candidateIDs),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var candidateID=_step.value;newFocus=document.getElementById(candidateID);if(newFocus){break}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return newFocus}else{return undefined}};var findAutofocus=function findAutofocus(candidateContainer){var _getFocusables;var destination=getPreferredDestination(candidateContainer);if(destination!==undefined&&destination!==null){candidateContainer===null||candidateContainer===void 0||candidateContainer.setAttribute(DATA_FOCUS_ATTRIBUTE,destination===null||destination===void 0?void 0:destination.id);return destination}var newFocus=document.getElementById(candidateContainer===null||candidateContainer===void 0?void 0:candidateContainer.getAttribute(DATA_FOCUS_ATTRIBUTE));if(newFocus){return newFocus}newFocus=(_getFocusables=getFocusables(candidateContainer))===null||_getFocusables===void 0?void 0:_getFocusables[0];if(!newFocus||matches(newFocus,containerSelector)){return null}candidateContainer===null||candidateContainer===void 0||candidateContainer.setAttribute(DATA_FOCUS_ATTRIBUTE,getId(newFocus));return newFocus};var getNextFromCandidates=function getNextFromCandidates(searchOriginsParent,focusableCandidates,exitDir,blockSetExits){var _iterator2=_createForOfIteratorHelper(focusableCandidates),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var candidate=_step2.value;var candidateIsContainer=matches(candidate,containerSelector);var candidatesParent=_getParentContainer(candidate);var candidateContainer=candidateIsContainer?candidate:candidatesParent;var isCurrentContainer=candidateContainer===searchOriginsParent;var isNestedContainer=searchOriginsParent===null||searchOriginsParent===void 0?void 0:searchOriginsParent.contains(candidateContainer);var isAnscestorContainer=candidateContainer===null||candidateContainer===void 0?void 0:candidateContainer.contains(searchOriginsParent);var candidateContainerAutoFocus=(candidateContainer===null||candidateContainer===void 0?void 0:candidateContainer.getAttribute(DATA_AUTOFOCUS_ATTRIBUTE))==="true";if(!isCurrentContainer&&(!isNestedContainer||candidateIsContainer)){if(blockSetExits){var blockedExitDirs=getBlockedExitDirs(searchOriginsParent,candidateContainer);if(blockedExitDirs.indexOf(exitDir)>-1){return null}}if(candidateContainer&&!isAnscestorContainer){if(candidateIsContainer&&candidateContainerAutoFocus){var nextFocus=findAutofocus(candidateContainer);if(nextFocus){return nextFocus}continue}else{console.log("Else of: candidateIsContainer && candidateContainerAutoFocus: ",candidate);if(candidatesParent&&candidateContainerAutoFocus){var _nextFocus=findAutofocus(candidateContainer);if(_nextFocus){return _nextFocus}}}}else{console.log("Did not enter: candidateContainer && !isAnscestorContainer: ",candidate)}}else{console.log("Did not enter: (!isCurrentContainer && (!isNestedContainer || candidateIsContainer)): ",candidate)}if(!candidateIsContainer&&candidateContainerAutoFocus){candidateContainer===null||candidateContainer===void 0||candidateContainer.setAttribute(DATA_FOCUS_ATTRIBUTE,getId(candidate))}return candidate}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return null};var getNextFocus=exports.getNextFocus=function getNextFocus(elem,keyOrKeyCode,scope){if(!scope||!scope.querySelector)scope=document.body;if(!elem)return getDefaultFocus(scope);var exitDir=_keyMap[keyOrKeyCode];var nextFocus=null;var parentContainer=_getParentContainer(elem);var focusableCandidates=[];if(parentContainer){var candidates=getAllFocusables(parentContainer);focusableCandidates=sortValidCandidates(candidates,elem,exitDir);if(focusableCandidates.length){nextFocus=getNextFromCandidates(parentContainer,focusableCandidates,exitDir,false)}}if(focusableCandidates.length===0){var _candidates=getAllFocusables(scope);focusableCandidates=sortValidCandidates(_candidates,elem,exitDir);nextFocus=getNextFromCandidates(parentContainer,focusableCandidates,exitDir,true);if(nextFocus){return nextFocus}}return nextFocus};

//# sourceMappingURL=lrud.min.js.map