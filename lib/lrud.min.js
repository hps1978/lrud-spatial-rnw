"use strict";exports.__esModule=true;exports.setConfig=exports.getNextFocus=void 0;function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t["return"]||t["return"]()}finally{if(u)throw o}}}}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var focusableSelector="[tabindex], a, input, button";var containerSelector="nav, section, .lrud-container";var ignoreSelector=".lrud-ignore, [disabled]";var DESTINATIONS_ATTRIBUTE="data-destinations";var _left="left",_right="right",_up="up",_down="down";var _keyMap={4:_left,21:_left,37:_left,214:_left,205:_left,218:_left,5:_right,22:_right,39:_right,213:_right,206:_right,217:_right,29460:_up,19:_up,38:_up,211:_up,203:_up,215:_up,29461:_down,20:_down,40:_down,212:_down,204:_down,216:_down,"ArrowLeft":_left,"ArrowRight":_right,"ArrowUp":_up,"ArrowDown":_down};var createMissingId=null;var setConfig=exports.setConfig=function setConfig(config){_keyMap=config.keyMap||_keyMap;createMissingId=_typeof(config.createMissingId)===Function?config.createMissingIdCallback:null};var getId=function getId(element){var _element$id;element.id&&(_element$id=element.id)!==null&&_element$id!==void 0&&_element$id.length?element.id:createMissingId?createMissingId(element):""};var matches=function matches(element,selectors){if(!element){console.warn("matches() passed with a null element");return false}var fn=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){var matches=(this.document||this.ownerDocument).querySelectorAll(s),i=matches.length;while(--i>=0&&matches.item(i)!==this){}return i>-1};return fn.call(element,selectors)};var toArray=function toArray(nodeList){return Array.prototype.slice.call(nodeList)};var _getParentContainer=function getParentContainer(elem){if(!elem.parentElement||elem.parentElement.tagName==="BODY"){return null}else if(matches(elem.parentElement,containerSelector)){return elem.parentElement}return _getParentContainer(elem.parentElement)};var getFocusables=function getFocusables(scope){if(!scope)return[];var ignoredElements=toArray(scope.querySelectorAll(ignoreSelector));return toArray(scope.querySelectorAll(focusableSelector)).filter(function(node){return!ignoredElements.some(function(ignored){return ignored==node||ignored.contains(node)})}).filter(function(node){return node.className.includes("lrud-container")||parseInt(node.getAttribute("tabindex")||"0",10)>-1})};var getAllFocusables=function getAllFocusables(scope){return([].concat(getFocusables(scope)))};var collectContainers=function collectContainers(initialContainer){if(!initialContainer)return[];var acc=[initialContainer];var cur=initialContainer;while(cur){cur=_getParentContainer(cur);if(cur)acc.push(cur)}return acc};var getMidpointForEdge=function getMidpointForEdge(rect,dir){switch(dir){case"left":return{x:rect.left,y:(rect.top+rect.bottom)/2};case"right":return{x:rect.right,y:(rect.top+rect.bottom)/2};case"up":return{x:(rect.left+rect.right)/2,y:rect.top};case"down":return{x:(rect.left+rect.right)/2,y:rect.bottom}}};var getNearestPoint=function getNearestPoint(point,dir,rect){if(dir==="left"||dir==="right"){var x=dir==="left"?rect.right:rect.left;if(point.y<rect.top)return{x:x,y:rect.top};if(point.y>rect.bottom)return{x:x,y:rect.bottom};return{x:x,y:point.y}}else if(dir==="up"||dir==="down"){var y=dir==="up"?rect.bottom:rect.top;if(point.x<rect.left)return{x:rect.left,y:y};if(point.x>rect.right)return{x:rect.right,y:y};return{x:point.x,y:y}}};var getDistanceBetweenPoints=function getDistanceBetweenPoints(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))};var isBelow=function isBelow(a,b){return a.y>b.y};var isRight=function isRight(a,b){return a.x>b.x};var getBlockedExitDirs=function getBlockedExitDirs(container,candidateContainer){if(!container){return[]}var currentAncestorContainers=collectContainers(container);var candidateAncestorContainers=collectContainers(candidateContainer);for(var i=0;i<candidateAncestorContainers.length;i++){var commonCandidate=candidateAncestorContainers[i];var spliceIndex=currentAncestorContainers.indexOf(commonCandidate);if(spliceIndex>-1){currentAncestorContainers.splice(spliceIndex);break}}return currentAncestorContainers.reduce(function(acc,cur){var dirs=((cur===null||cur===void 0?void 0:cur.getAttribute("data-block-exit"))||"").split(" ");return acc.concat(dirs)},[])};var isValidCandidate=function isValidCandidate(entryRect,exitDir,exitPoint,entryWeighting){if(entryRect.width===0&&entryRect.height===0)return false;if(!entryWeighting&&entryWeighting!=0)entryWeighting=0.3;var weightedEntryPoint={x:entryRect.left+entryRect.width*(exitDir==="left"?1-entryWeighting:exitDir==="right"?entryWeighting:0.5),y:entryRect.top+entryRect.height*(exitDir==="up"?1-entryWeighting:exitDir==="down"?entryWeighting:0.5)};if(exitDir==="left"&&isRight(exitPoint,weightedEntryPoint)||exitDir==="right"&&isRight(weightedEntryPoint,exitPoint)||exitDir==="up"&&isBelow(exitPoint,weightedEntryPoint)||exitDir==="down"&&isBelow(weightedEntryPoint,exitPoint))return true;return false};var sortValidCandidates=function sortValidCandidates(candidates,elem,exitDir){var exitRect=elem.getBoundingClientRect();var exitPoint=getMidpointForEdge(exitRect,exitDir);return candidates.filter(function(candidate){var entryRect=candidate.getBoundingClientRect();var allowedOverlap=parseFloat(candidate.getAttribute("data-lrud-overlap-threshold"));return isValidCandidate(entryRect,exitDir,exitPoint,allowedOverlap)}).map(function(candidate){var entryRect=candidate.getBoundingClientRect();var nearestPoint=getNearestPoint(exitPoint,exitDir,entryRect);var distance=getDistanceBetweenPoints(exitPoint,nearestPoint);return{candidate:candidate,distance:distance}}).sort(function(a,b){return a.distance-b.distance}).map(function(_ref){var candidate=_ref.candidate;return candidate})};var getPreferredDestination=function getPreferredDestination(parentContainer){var destinations=parentContainer===null||parentContainer===void 0?void 0:parentContainer.getAttribute(DESTINATIONS_ATTRIBUTE);if(destinations!==null&&destinations!==void 0&&destinations.length){var candidateIDs=destinations.split(" ");var newFocus=null;var _iterator=_createForOfIteratorHelper(candidateIDs),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var candidateID=_step.value;newFocus=document.getElementById(candidateID);if(newFocus){break}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return newFocus}else{return undefined}};var getNextFocus=exports.getNextFocus=function getNextFocus(elem,keyOrKeyCode,scope){var _getFocusables;if(!scope||!scope.querySelector)scope=document.body;if(!elem)return(_getFocusables=getFocusables(scope))===null||_getFocusables===void 0?void 0:_getFocusables[0];var exitDir=_keyMap[keyOrKeyCode];var parentContainer=_getParentContainer(elem);if(parentContainer&&matches(elem,focusableSelector)){parentContainer.setAttribute("data-focus",getId(elem))}var focusableCandidates=[];if((parentContainer===null||parentContainer===void 0?void 0:parentContainer.getAttribute("data-lrud-prioritise-children"))!=="false"&&scope.contains(parentContainer)){var focusableSiblings=getAllFocusables(parentContainer);focusableCandidates=sortValidCandidates(focusableSiblings,elem,exitDir)}if(focusableCandidates.length===0){var candidates=getAllFocusables(scope);focusableCandidates=sortValidCandidates(candidates,elem,exitDir)}var _iterator2=_createForOfIteratorHelper(focusableCandidates),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var candidate=_step2.value;var candidateIsContainer=matches(candidate,containerSelector);var candidateContainer=candidateIsContainer?candidate:_getParentContainer(candidate);var isCurrentContainer=candidateContainer===parentContainer;var isNestedContainer=parentContainer===null||parentContainer===void 0?void 0:parentContainer.contains(candidateContainer);var isAnscestorContainer=candidateContainer===null||candidateContainer===void 0?void 0:candidateContainer.contains(parentContainer);if(!isCurrentContainer&&(!isNestedContainer||candidateIsContainer)){var blockedExitDirs=getBlockedExitDirs(parentContainer,candidateContainer);if(blockedExitDirs.indexOf(exitDir)>-1)continue;if(candidateContainer&&!isAnscestorContainer){var _getFocusables2;if(candidateIsContainer){var destination=getPreferredDestination(candidateContainer);if(destination!==undefined){if(destination!==null){candidateContainer===null||candidateContainer===void 0||candidateContainer.setAttribute("data-focus",destination===null||destination===void 0?void 0:destination.id)}return destination}}var lastActiveChild=document.getElementById(candidateContainer===null||candidateContainer===void 0?void 0:candidateContainer.getAttribute("data-focus"));var newFocus=lastActiveChild||((_getFocusables2=getFocusables(candidateContainer))===null||_getFocusables2===void 0?void 0:_getFocusables2[0]);if(matches(newFocus,containerSelector)){continue}candidateContainer===null||candidateContainer===void 0||candidateContainer.setAttribute("data-focus",getId(newFocus));return newFocus}}if(!candidateIsContainer){candidateContainer===null||candidateContainer===void 0||candidateContainer.setAttribute("data-focus",getId(candidate))}return candidate}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}};

//# sourceMappingURL=lrud.min.js.map