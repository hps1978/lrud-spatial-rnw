"use strict";exports.__esModule=true;exports.updateAncestorsAutoFocus=exports.setConfig=exports.getNextFocus=exports.getFocusableParentContainer=void 0;function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t["return"]||t["return"]()}finally{if(u)throw o}}}}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var focusableSelector="[tabindex], a, input, button";var LRUD_CONTAINER="lrud-container";var ignoreSelector=".lrud-ignore, [disabled]";var DESTINATIONS_ATTRIBUTE="data-destinations";var DATA_BLOCK_EXIT_ATTRIBUTE="data-block-exit";var DATA_AUTOFOCUS_ATTRIBUTE="data-autofocus";var DATA_FOCUS_ATTRIBUTE="data-focus";var _left="left",_right="right",_up="up",_down="down";var _keyMap={4:_left,21:_left,37:_left,214:_left,205:_left,218:_left,5:_right,22:_right,39:_right,213:_right,206:_right,217:_right,29460:_up,19:_up,38:_up,211:_up,203:_up,215:_up,29461:_down,20:_down,40:_down,212:_down,204:_down,216:_down,"ArrowLeft":_left,"ArrowRight":_right,"ArrowUp":_up,"ArrowDown":_down};var _noValidDestinationCallback=function _noValidDestinationCallback(elem,hasAutoFocus){console.warn("No valid destination found for LRUD container: ",elem,"with autofocus: ",hasAutoFocus)};var setConfig=exports.setConfig=function setConfig(config){_keyMap=config.keyMap||_keyMap;_noValidDestinationCallback=config.noValidDestinationCallback||_noValidDestinationCallback};var isStrictDescendant=function isStrictDescendant(child,ancestor){return child!==ancestor&&ancestor.contains(child)};var isContainer=function isContainer(node){var _node$classList;return node===null||node===void 0||(_node$classList=node.classList)===null||_node$classList===void 0?void 0:_node$classList.contains(LRUD_CONTAINER)};var isContainerWithAutofocus=function isContainerWithAutofocus(node){var _node$classList2;return(node===null||node===void 0||(_node$classList2=node.classList)===null||_node$classList2===void 0?void 0:_node$classList2.contains(LRUD_CONTAINER))&&(node===null||node===void 0?void 0:node.getAttribute(DATA_AUTOFOCUS_ATTRIBUTE))==="true"};var isContainerTVFocusable=function isContainerTVFocusable(node){var _node$classList3;return((node===null||node===void 0||(_node$classList3=node.classList)===null||_node$classList3===void 0?void 0:_node$classList3.contains(LRUD_CONTAINER))&&(node===null||node===void 0?void 0:node.tabIndex)===0)};var toArray=function toArray(nodeList){return Array.prototype.slice.call(nodeList)};var _getParentContainerWithBlockedExits=function getParentContainerWithBlockedExits(elem){var parent=elem===null||elem===void 0?void 0:elem.parentElement;var blockExits=parent===null||parent===void 0?void 0:parent.getAttribute(DATA_BLOCK_EXIT_ATTRIBUTE);if(!parent||parent.tagName==="BODY"){return{parent:null,blockExits:null}}else if(isContainer(parent)&&(blockExits===null||blockExits===void 0?void 0:blockExits.length)>0){return{parent:parent,blockExits:blockExits}}return _getParentContainerWithBlockedExits(parent)};var _getFocusableParentContainer=exports.getFocusableParentContainer=function getFocusableParentContainer(elem){var _elem$parentElement;if(!(elem!==null&&elem!==void 0&&elem.parentElement)||(elem===null||elem===void 0?void 0:elem.parentElement.tagName)==="BODY"){return null}else if(isContainer(elem.parentElement)&&(elem===null||elem===void 0||(_elem$parentElement=elem.parentElement)===null||_elem$parentElement===void 0?void 0:_elem$parentElement.tabIndex)===0){return elem.parentElement}return _getFocusableParentContainer(elem.parentElement)};var _getFirstFocusableElement=function getFirstFocusableElement(container){var focusable={elem:null,parentHasAutofocus:false};if(!container)return focusable;var focusables=toArray(container.querySelectorAll(focusableSelector));if(focusables.length>0){var firstFocusable=focusables[0];if(!isContainer(firstFocusable)){focusable.elem=firstFocusable;focusable.parentHasAutofocus=(container===null||container===void 0?void 0:container.getAttribute(DATA_AUTOFOCUS_ATTRIBUTE))==="true"}else{return _getFirstFocusableElement(firstFocusable)}}return focusable};var getFocusables=function getFocusables(elem,scope){var _focusables2;if(!scope)return[];var ignoredElements=toArray(scope.querySelectorAll(ignoreSelector));var focusables=toArray(scope.querySelectorAll(focusableSelector)).filter(function(node){return!ignoredElements.some(function(ignored){return ignored==node||ignored.contains(node)})}).filter(function(node){return parseInt(node.getAttribute("tabindex")||"-1",10)>-1});if(elem){var _focusables;focusables=(_focusables=focusables)===null||_focusables===void 0?void 0:_focusables.filter(function(node){return isContainer(node)&&node.contains(elem)?false:true})}var childrenToIgnore=new Set;(_focusables2=focusables)===null||_focusables2===void 0||_focusables2.forEach(function(node){if(isContainerTVFocusable(node)){var allChildren=toArray(node.querySelectorAll(focusableSelector));allChildren.forEach(function(child){return childrenToIgnore.add(child)})}});if(childrenToIgnore.size>0){var _focusables3;focusables=(_focusables3=focusables)===null||_focusables3===void 0?void 0:_focusables3.filter(function(node){return!childrenToIgnore.has(node)})}return focusables};var getDefaultFocus=function getDefaultFocus(scope,exitDir){var nextFocus={elem:null,parentHasAutofocus:false};var candidates=getAllFocusables(null,scope);if(candidates.length>0){var candidate=candidates[0];var candidateIsContainer=isContainer(candidate);if(candidateIsContainer){nextFocus=findDestinationOrAutofocus(null,exitDir,candidate,false)}else{nextFocus={elem:candidate,parentHasAutofocus:false}}}return nextFocus};var getAllFocusables=function getAllFocusables(elem,scope){return([].concat(getFocusables(elem,scope)))};var getMidpointForEdge=function getMidpointForEdge(rect,dir){switch(dir){case"left":return{x:rect.left,y:(rect.top+rect.bottom)/2};case"right":return{x:rect.right,y:(rect.top+rect.bottom)/2};case"up":return{x:(rect.left+rect.right)/2,y:rect.top};case"down":return{x:(rect.left+rect.right)/2,y:rect.bottom}}};var getNearestPoint=function getNearestPoint(point,dir,rect){if(dir==="left"||dir==="right"){var x=dir==="left"?rect.right:rect.left;if(point.y<rect.top)return{x:x,y:rect.top};if(point.y>rect.bottom)return{x:x,y:rect.bottom};return{x:x,y:point.y}}else if(dir==="up"||dir==="down"){var y=dir==="up"?rect.bottom:rect.top;if(point.x<rect.left)return{x:rect.left,y:y};if(point.x>rect.right)return{x:rect.right,y:y};return{x:point.x,y:y}}};var getDistanceBetweenPoints=function getDistanceBetweenPoints(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))};var isBelow=function isBelow(a,b){return a.y>b.y};var isRight=function isRight(a,b){return a.x>b.x};var isValidCandidate=function isValidCandidate(entryRect,exitDir,exitPoint,entryWeighting){if(entryRect.width===0&&entryRect.height===0)return false;if(!entryWeighting&&entryWeighting!=0)entryWeighting=0.3;var weightedEntryPoint={x:entryRect.left+entryRect.width*(exitDir==="left"?1-entryWeighting:exitDir==="right"?entryWeighting:0.5),y:entryRect.top+entryRect.height*(exitDir==="up"?1-entryWeighting:exitDir==="down"?entryWeighting:0.5)};if(exitDir==="left"&&isRight(exitPoint,weightedEntryPoint)||exitDir==="right"&&isRight(weightedEntryPoint,exitPoint)||exitDir==="up"&&isBelow(exitPoint,weightedEntryPoint)||exitDir==="down"&&isBelow(weightedEntryPoint,exitPoint))return true;return false};var sortValidCandidates=function sortValidCandidates(candidates,elem,exitDir){var exitRect=(elem===null||elem===void 0?void 0:elem.getBoundingClientRect())||{left:0,right:0,top:0,bottom:0,width:0,height:0};var exitPoint=getMidpointForEdge(exitRect,exitDir);var EPSILON=1e-6;var AXIS_OVERLAP_THRESHOLD=0.3;var getAxisOverlapRatio=function getAxisOverlapRatio(originRect,entryRect){if(!originRect||!entryRect)return 0;if(exitDir==="left"||exitDir==="right"){var _overlap=Math.max(0,Math.min(originRect.bottom,entryRect.bottom)-Math.max(originRect.top,entryRect.top));return originRect.height>0?_overlap/originRect.height:0}var overlap=Math.max(0,Math.min(originRect.right,entryRect.right)-Math.max(originRect.left,entryRect.left));return originRect.width>0?overlap/originRect.width:0};return candidates.filter(function(candidate){var entryRect=candidate.getBoundingClientRect();var allowedOverlap=parseFloat(candidate.getAttribute("data-lrud-overlap-threshold"));return isValidCandidate(entryRect,exitDir,exitPoint,allowedOverlap)}).map(function(candidate,idx){var entryRect=candidate.getBoundingClientRect();var nearestPoint=getNearestPoint(exitPoint,exitDir,entryRect);var distance=getDistanceBetweenPoints(exitPoint,nearestPoint);var axisOverlapRatio=getAxisOverlapRatio(exitRect,entryRect);var axisOverlap=axisOverlapRatio>=AXIS_OVERLAP_THRESHOLD;var alignmentDelta=exitDir==="left"||exitDir==="right"?Math.abs(exitPoint.y-nearestPoint.y):Math.abs(exitPoint.x-nearestPoint.x);return{candidate:candidate,distance:distance,alignmentDelta:alignmentDelta,axisOverlap:axisOverlap,idx:idx}}).sort(function(a,b){if(a.axisOverlap!==b.axisOverlap)return a.axisOverlap?-1:1;if(a.axisOverlap&&b.axisOverlap){var distanceDiff=a.distance-b.distance;if(Math.abs(distanceDiff)>EPSILON)return distanceDiff;var alignmentDiff=a.alignmentDelta-b.alignmentDelta;if(Math.abs(alignmentDiff)>EPSILON)return alignmentDiff}else{var _alignmentDiff=a.alignmentDelta-b.alignmentDelta;if(Math.abs(_alignmentDiff)>EPSILON)return _alignmentDiff;var _distanceDiff=a.distance-b.distance;if(Math.abs(_distanceDiff)>EPSILON)return _distanceDiff}return a.idx-b.idx}).map(function(_ref){var candidate=_ref.candidate;return candidate})};var getPreferredDestination=function getPreferredDestination(parentContainer){var destinations=parentContainer===null||parentContainer===void 0?void 0:parentContainer.getAttribute(DESTINATIONS_ATTRIBUTE);if(destinations!==null&&destinations!==void 0&&destinations.length){var candidateIDs=destinations.split(" ");var newFocus=null;var _iterator=_createForOfIteratorHelper(candidateIDs),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var candidateID=_step.value;newFocus=document.getElementById(candidateID);if(newFocus){break}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return newFocus}else{return undefined}};var findDestinationOrAutofocus=function findDestinationOrAutofocus(elem,exitDir,candidateContainer,domOrderAsDefault){var hasAutoFocus=(candidateContainer===null||candidateContainer===void 0?void 0:candidateContainer.getAttribute(DATA_AUTOFOCUS_ATTRIBUTE))==="true";var newFocus={elem:null,parentHasAutofocus:hasAutoFocus};newFocus.elem=getPreferredDestination(candidateContainer);if(newFocus.elem!==undefined&&newFocus.elem!==null){return newFocus}if(newFocus.elem===null){_noValidDestinationCallback(candidateContainer,hasAutoFocus)}if(newFocus.elem===null&&!hasAutoFocus){var candidateContainerFocusables=getFocusables(null,candidateContainer);var candidates=sortValidCandidates(candidateContainerFocusables,elem,exitDir);newFocus=getNextFromCandidates(candidates,elem,exitDir);return newFocus}if(hasAutoFocus){newFocus.elem=document.getElementById(candidateContainer===null||candidateContainer===void 0?void 0:candidateContainer.getAttribute(DATA_FOCUS_ATTRIBUTE));if(newFocus.elem){return newFocus}if(domOrderAsDefault){newFocus=_getFirstFocusableElement(candidateContainer)}else{var _candidateContainerFocusables=getFocusables(null,candidateContainer);var _candidates=sortValidCandidates(_candidateContainerFocusables,elem,exitDir);newFocus=getNextFromCandidates(_candidates,elem,exitDir)}return newFocus}return{elem:null,parentHasAutofocus:hasAutoFocus}};var getNextFromCandidates=function getNextFromCandidates(focusableCandidates,elem,exitDir){var _originsBlockedInfo$b;var nextFocus={elem:null,parentHasAutofocus:false};var originsBlockedInfo=_getParentContainerWithBlockedExits(elem);var exitsBlocked=originsBlockedInfo===null||originsBlockedInfo===void 0||(_originsBlockedInfo$b=originsBlockedInfo.blockExits)===null||_originsBlockedInfo$b===void 0?void 0:_originsBlockedInfo$b.includes(exitDir);var _iterator2=_createForOfIteratorHelper(focusableCandidates),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var candidate=_step2.value;var candidateIsContainer=isContainer(candidate);if(exitsBlocked){if(!isStrictDescendant(candidate,originsBlockedInfo.parent)){return{elem:null,parentHasAutofocus:false}}}if(candidateIsContainer){nextFocus=findDestinationOrAutofocus(elem,exitDir,candidate,true);return nextFocus}else{var _getFocusableParentCo;var parentHasAutofocus=((_getFocusableParentCo=_getFocusableParentContainer(candidate))===null||_getFocusableParentCo===void 0?void 0:_getFocusableParentCo.getAttribute(DATA_AUTOFOCUS_ATTRIBUTE))==="true";nextFocus={elem:candidate,parentHasAutofocus:parentHasAutofocus};return nextFocus}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return nextFocus};var updateAncestorsAutoFocus=exports.updateAncestorsAutoFocus=function updateAncestorsAutoFocus(elem,scope){var current=elem.parentElement;while(current&&current!==scope&&current.tagName!=="BODY"){if(isContainerWithAutofocus(current)){current.setAttribute(DATA_FOCUS_ATTRIBUTE,elem.id)}current=current.parentElement}};var getNextFocus=exports.getNextFocus=function getNextFocus(elem,keyOrKeyCode,scope){var exitDir=_keyMap[keyOrKeyCode];if(!scope||!scope.querySelector)scope=document.body;if(!elem)return getDefaultFocus(scope,exitDir);var nextFocus=null;var candidates=[];var focusables=getAllFocusables(elem,scope);candidates=sortValidCandidates(focusables,elem,exitDir);nextFocus=getNextFromCandidates(candidates,elem,exitDir);return nextFocus};

//# sourceMappingURL=lrud.min.js.map